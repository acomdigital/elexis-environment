#!/usr/bin/env bash

if [[ ! -f "${INSTALL_DIR}.env" ]]; then
  echo ".env file does not exist, please initialize"
  exit -1
fi

#
# REPLACING INTERNAL VARIABLES
#
# generate rocketchat oauth client secret
sed -i -e "s/X_EE_RC_OAUTH_CLIENT_SECRET=missing/X_EE_RC_OAUTH_CLIENT_SECRET=$(uuidgen)/g" ${INSTALL_DIR}.env

docker build -t ee-configure ${INSTALL_DIR}docker/ee-config/.
PWD=$(pwd)
docker run --rm --env-file ${INSTALL_DIR}.env -v ${INSTALL_DIR}assets/:/assets -it ee-configure
docker rmi ee-configure
