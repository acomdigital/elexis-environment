#!/usr/bin/env bash

if [[ ! -f "${INSTALL_DIR}.env" ]]; then
  echo ".env file does not exist, please initialize"
  exit -1
fi

#
# REPLACING INTERNAL VARIABLES
#
# generate rocketchat oauth client secret
sed -i -e "s/X_EE_RC_OAUTH_CLIENT_SECRET=missing/X_EE_RC_OAUTH_CLIENT_SECRET=$(uuidgen)/g" ${INSTALL_DIR}.env

docker build -q -t ee-util ${INSTALL_DIR}docker/ee-util/.
PWD=$(pwd)
docker run --rm --env-file ${INSTALL_DIR}.env -v ${INSTALL_DIR}assets/:/assets -v ${INSTALL_DIR}:/installdir:ro ee-util /configure.sh
docker rmi ee-util > /dev/null
